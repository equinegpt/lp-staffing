<!-- app/templates/admin_staff_detail.html -->
{% extends "base.html" %}
{% block title %}{{ s.display_name }}{% endblock %}
{% block body %}

  <div style="display:flex; align-items:center; gap:14px;">
    <h1 style="margin:0;">{{ s.display_name }}</h1>
    {% if s.end_date %}
      <span class="badge badge-danger">Inactive</span>
    {% else %}
      <span class="badge badge-success">Active</span>
    {% endif %}
    <a class="btn small" href="/admin/staff/{{ s.id }}/edit" style="margin-left:auto;">Edit</a>
  </div>

  <section class="card" style="margin-top:14px;">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
      <div>
        <div style="margin-bottom:12px;"><strong>Mobile</strong><br>{{ s.mobile|phone_au }}</div>
        <div><strong>Email</strong><br>{{ s.email or '—' }}</div>
      </div>
      <div>
        <div style="margin-bottom:12px;"><strong>Start</strong><br>{{ s.start_date }}</div>
        <div style="display:flex; gap:10px; align-items:center;">
          <div class="grow">
            <strong>End</strong><br>
            <input id="end-d" name="end_date" type="date" />
          </div>
          <button class="btn warn"
                  hx-post="/admin/staff/{{ s.id }}/end"
                  hx-include="#end-d"
                  hx-swap="none">
            End employment
          </button>
          <button class="btn"
                  hx-post="/admin/staff/{{ s.id }}/reactivate"
                  hx-swap="none">
            Reactivate
          </button>
        </div>
        <div style="font-size:12px; opacity:.7; margin-top:6px;">
          Choose an end date then click “End employment”.
        </div>
      </div>
    </div>
  </section>

  <!-- Assignments -->
  <section class="card" style="margin-top:18px;">
    <h2 style="margin:0 0 10px;">Assignments</h2>

    <!-- tidy toolbar -->
    <form class="assign-toolbar"
          hx-post="/admin/staff/{{ s.id }}/assign"
          hx-target="#assignments"
          hx-swap="innerHTML">
      <div class="grow">
        <label>Role</label>
        <select name="role_code" required>
          <option value="">— select —</option>
          {% for r in roles %}
            <option value="{{ r.code }}">{{ r.label }} — {{ r.code }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="grow">
        <label>Location (required)</label>
        <select name="location_code" required>
          <option value="">— select —</option>
          {% for l in locations %}
            <option value="{{ l.code }}">{{ l.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>Start</label>
        <input type="date" name="effective_start" required />
      </div>
      <div>
        <label>End (optional)</label>
        <input type="date" name="effective_end" />
      </div>
      <div class="actions">
        <button class="btn primary" type="submit">Add/Update</button>
      </div>
    </form>

    <div id="assignments"
         hx-get="/admin/staff/{{ s.id }}/assignments/table"
         hx-trigger="load"
         hx-swap="innerHTML"
         style="margin-top:14px;">
      Loading…
    </div>
  </section>

{% endblock %}
