{% extends "base.html" %}
{% block title %}Staff{% endblock %}

{% block content %}
  <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
    <h1 class="page-title" style="margin:0">{{ s.display_name }}</h1>
    {% if s.end_date %}
      <span class="pill pill--bad">Inactive</span>
    {% else %}
      <span class="pill pill--ok">Active</span>
    {% endif %}
    <div style="margin-left:auto">
      <a class="btn btn-secondary" href="/admin/staff/{{ s.id }}/edit">Edit</a>
    </div>
  </div>

  <div class="detail-grid">
    <section class="card block">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
        <div>
          <div class="label">Mobile</div>
          <div>{{ s.mobile|phone_au }}</div>
          <div class="label" style="margin-top:12px;">Email</div>
          <div>{{ s.email or "—" }}</div>
        </div>
        <div>
          <div class="label">Start</div>
          <div>{{ s.start_date }}</div>

          <div class="label" style="margin-top:12px;">End</div>
          <div>{{ s.end_date or "—" }}</div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid #eef2f7;margin:16px 0;" />

      <form method="post" action="/admin/staff/{{ s.id }}/end" class="inline-actions">
        <div class="control" style="min-width:200px;">
          <label class="label" for="end_date">Choose end date</label>
          <input class="input" id="end_date" name="end_date" type="date" />
        </div>
        <button class="btn btn-danger" type="submit">End employment</button>

        <div class="helper">Choose the end date then click “End employment”.</div>

        <a class="btn btn-secondary" style="margin-left:auto" href="/admin/staff/{{ s.id }}/reactivate">Reactivate</a>
      </form>
    </section>

    <section class="card block">
      <h2 style="margin:0 0 10px 0;">Assignments</h2>

      {% include "partials/assignments_table.html" %}
      <hr style="border:none;border-top:1px solid #eef2f7;margin:16px 0;" />

      <form method="post" action="/admin/staff/{{ s.id }}/assign">
        <div class="control" style="margin-bottom:8px;">
          <label class="label" for="role_code">Role</label>
          <select class="input" id="role_code" name="role_code" required>
            <option value="">— select —</option>
            {% for r in roles %}
              <option value="{{ r.code }}">{{ r.label }} — {{ r.code }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="control" style="margin-bottom:8px;">
          <label class="label" for="location_code">Location <span class="helper">(required)</span></label>
          <select class="input" id="location_code" name="location_code" required>
            <option value="">— select —</option>
            {% for l in locations %}
              <option value="{{ l.code }}">{{ l.name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="control" style="margin-bottom:8px;">
          <label class="label" for="effective_start">Start</label>
          <input class="input" id="effective_start" name="effective_start" type="date" required />
        </div>

        <div class="control" style="margin-bottom:12px;">
          <label class="label" for="effective_end">End <span class="helper">(optional)</span></label>
          <input class="input" id="effective_end" name="effective_end" type="date" />
        </div>

        <button class="btn btn-primary" type="submit">Add assignment</button>
        <div class="helper" style="margin-top:8px;">
          Only one active role/location at a time — adding a new one will end the current one.
        </div>
      </form>
    </section>
  </div>
{% endblock %}
