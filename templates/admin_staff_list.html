{% extends "base.html" %}
{% block title %}Staff list{% endblock %}

{% block content %}
  <h1 class="page-title">Staff list — {{ day|date_long }}</h1>

  <form method="get" action="/admin/staff" class="card block">
    <div class="controls">
      <div class="control">
        <label class="label" for="d">Date</label>
        <input class="input" id="d" name="d" type="date" value="{{ day }}" />
      </div>

      <div class="control">
        <label class="label" for="role">Role</label>
        <select class="input" id="role" name="role">
          <option value="">Any role</option>
          {% for r in roles %}
            <option value="{{ r.code }}" {{ "selected" if active_role == r.code else "" }}>
              {{ r.label }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="control">
        <label class="label" for="location">Location</label>
        <select class="input" id="location" name="location">
          <option value="">Any location</option>
          {% for l in locations %}
            <option value="{{ l.code }}" {{ "selected" if active_loc == l.code else "" }}>
              {{ l.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="control">
        <label class="label" for="status">Status</label>
        <select class="input" id="status" name="status">
          <option value="" {{ "selected" if status == "" else "" }}>Any status</option>
          <option value="active" {{ "selected" if status == "active" else "" }}>Active</option>
          <option value="inactive" {{ "selected" if status == "inactive" else "" }}>Inactive</option>
        </select>
      </div>

      <div class="control">
        <label class="label" for="q">Search</label>
        <div class="search-row">
          <input class="search" id="q" name="q" type="text" placeholder="name or mobile" value="{{ q }}" />
          <button class="btn btn-secondary" type="submit">Apply</button>
        </div>
      </div>
    </div>

    <div class="actions-row">
      <a class="btn btn-primary" href="/admin/staff/new">+ Add staff</a>
      <a class="btn btn-secondary"
         href="/admin/staff/export.csv?d={{ day }}&role={{ active_role }}&location={{ active_loc }}&status={{ status }}&q={{ q }}">Export CSV</a>
    </div>
  </form>

  <div class="card">
    {% if staff|length == 0 %}
      <div class="empty">No staff match your filters for {{ day|date_long }}.</div>
    {% else %}
      <table class="table" aria-label="Staff">
        <thead>
          <tr>
            <th>Name</th>
            <th>Role</th>
            <th>Location</th>
            <th>Mobile</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="staff-table-body">
          {% for s in staff %}
            <tr>
              <td><a href="/admin/staff/{{ s.id }}">{{ s.display_name }}</a></td>
              <td>{{ s.role_label or s.role_code or "—" }}</td>
              <td>{{ s.location_code or "—" }}</td>
              <td>{{ s.mobile|phone_au }}</td>
              <td>
                {% if s.is_active %}
                  <span class="pill pill--ok">Active</span>
                {% else %}
                  <span class="pill pill--bad">Inactive</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
{% endblock %}
